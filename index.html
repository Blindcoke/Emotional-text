<!DOCTYPE html>
<html>
<head>
    <title>Emotions</title>
    <meta charset="utf-8" />
</head>
<body>
    <form>
        <label for="fname">Write a phrase you want to grasp:</label><br>
        <input type="text" id="fname" name="fname"><br>
        <input type="button" value="Submit" onclick="submitForm()" />
        
    </form>
    <div id="result">
    </div>
    <script>
    const emotionMap = {
        "admiration": "ðŸ˜",
        "amusement": "ðŸ˜„",
        "anger": "ðŸ˜¡",
        "annoyance": "ðŸ˜’",
        "approval": "ðŸ‘",
        "caring": "â¤ï¸",
        "confusion": "ðŸ˜•",
        "curiosity": "ðŸ¤”",
        "desire": "ðŸ˜",
        "disappointment": "ðŸ˜ž",
        "disapproval": "ðŸ‘Ž",
        "disgust": "ðŸ¤¢",
        "embarrassment": "ðŸ˜³",
        "excitement": "ðŸ˜ƒ",
        "fear": "ðŸ˜±",
        "gratitude": "ðŸ™",
        "grief": "ðŸ˜¢",
        "joy": "ðŸ˜‚",
        "love": "â¤ï¸",
        "nervousness": "ðŸ˜¬",
        "optimism": "ðŸ˜Š",
        "pride": "ðŸ†",
        "realization": "ðŸ˜²",
        "relief": "ðŸ˜…",
        "remorse": "ðŸ˜”",
        "sadness": "ðŸ˜¢",
        "surprise": "ðŸ˜®",
        "neutral": "ðŸ˜"
    };
    function submitForm(){
        var sentence = document.getElementById("fname").value;
        console.log(sentence)
        fetch("/submit", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }, 
            body: JSON.stringify({text: sentence})
        }).then(response => response.json())
            .then(data => {
                console.log(data);
                if (/[\.\!\?]$/.test(sentence)) {
                    sentence += " ";
                }
                const symbolEmojies = sentence.match(/(?:\.+ |! |\? )/g);
                console.log(symbolEmojies);
                var sentences = sentence.split(/(?:\.+ |! |\? )/g);
                console.log(sentences);
                const emotionsArray = [];
                document.getElementById("result").innerHTML = "";
                for (var i = 0; i < data.predictions.length; i++) {
                    console.log(data.predictions[i][0].label);
                    const emotionsString = data.predictions[i][0].label;
                    emotionsArray.push(emotionsString);
                    const emoji = emotionMap[emotionsString] || "â“";
                    var emojiOut = emoji;
                    var dotCount = 0;

                    if (symbolEmojies && symbolEmojies[i]) {
                        for (var j = 0; j < symbolEmojies[i].length; j++) {
                            if (symbolEmojies[i][j] == "!") {
                                emojiOut += "â—ï¸";
                            } else if (symbolEmojies[i][j] == "?") {
                                emojiOut += "â“";
                            } else if (symbolEmojies[i][j] == ".") {
                                dotCount++;
                                if (dotCount >= 3) {
                                    emojiOut += "ðŸ˜";
                                } else {
                                    emojiOut = emojiOut;
                                }
                            }
                        }
                    }else {
                                emojiOut = emojiOut;
                            }

                    document.getElementById("result").innerHTML += sentences[i] + emojiOut + " ";
                }
                })
        .catch((error) => {
            console.error('Error:', error);
        });
    }
    </script>
</body>
</html>